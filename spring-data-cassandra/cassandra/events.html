<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lifecycle Events :: Spring Data Cassandra</title>
    <link rel="prev" href="converters.html">
    <link rel="next" href="auditing.html">
    <meta name="generator" content="Antora 3.2.0-alpha.2">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/vendor/search.css">
    <link rel="stylesheet" href="../_/css/vendor/asciidoctor-tabs.css">

    <meta name="version" content="4.2.0">
    <meta name="component" content="data-cassandra">
    <link rel="icon" href="../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spring.io">
        <img
          id="springlogo"
          class="block"
          src="../_/img/spring-logo.svg"
          alt="Spring"
        />
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Why Spring</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.io/why-spring"
            >Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/microservices"
            >Microservices</a>
            <a
              class="navbar-item"
              href="https://spring.io/reactive"
            >Reactive</a>
            <a class="navbar-item" href="https://spring.io/event-driven">Event
              Driven</a>
            <a class="navbar-item" href="https://spring.io/cloud">Cloud</a>
            <a class="navbar-item" href="https://spring.io/web-applications">Web
              Applications</a>
            <a
              class="navbar-item"
              href="https://spring.io/serverless"
            >Serverless</a>
            <a class="navbar-item" href="https://spring.io/batch">Batch</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Learn</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://spring.io/learn">Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/quickstart"
            >Quickstart</a>
            <a class="navbar-item" href="https://spring.io/guides">Guides</a>
            <a class="navbar-item" href="https://spring.io/blog">Blog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown" style="min-width: 280px">
            <a
              class="navbar-item"
              href="https://spring.io/projects"
            >Overview</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-boot"
            >Spring Boot</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-framework"
            >Spring Framework</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-cloud"
            >Spring Cloud</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-cloud-dataflow"
            >Spring Cloud Data Flow</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-data"
            >Spring Data</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-integration"
            >Spring Integration</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-batch"
            >Spring Batch</a>
            <a
              class="navbar-item"
              href="https://spring.io/projects/spring-security"
            >Spring Security</a>
            <a
              class="navbar-item navbar-item-special"
              href="https://spring.io/projects"
            >View all projects</a>
            <a class="navbar-item" href="https://spring.io/tools">Spring Tools 4</a>
            <a
              class="navbar-item navbar-item-special-2"
              href="https://start.spring.io"
            >Spring Initializr
              <svg
                class="external-link-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 16"
              ><polyline
                  points="15 10.94 15 15 1 15 1 1 5.06 1"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></polyline><polyline
                  points="8.93 1 15 1 15 7.07"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></polyline><line
                  x1="15"
                  y1="1"
                  x2="8"
                  y2="8"
                  fill="none"
                  stroke="currentColor"
                  stroke-miterlimit="10"
                  stroke-width="2"
                ></line></svg></a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Academy</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.academy/courses"
            >Courses</a>
            <a
              class="navbar-item"
              href="https://spring.academy/learning-path"
            >Get Certified</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Solutions</a>
          <div class="navbar-dropdown lg">
            <a class="navbar-item" href="https://spring.io/solutions">Overview</a>
            <a class="navbar-item" href="https://spring.io/runtime">Spring Runtime</a>
            <a class="navbar-item" href="https://spring.io/consulting">Spring Consulting</a>
            <a class="navbar-item" href="https://spring.academy/teams">Spring Academy For Teams</a>
            <a class="navbar-item" href="https://spring.io/security">Security Advisories</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable is-community">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a
              class="navbar-item"
              href="https://spring.io/community"
            >Overview</a>
            <a class="navbar-item" href="https://spring.io/events">Events</a>
            <a class="navbar-item" href="https://spring.io/team">Team</a>
          </div>
        </div>
      </div>
    </div>
    <label class="theme-toggler">
      <input
        type="checkbox"
        type="checkbox"
        id="switch-theme-checkbox"
        name="switch-theme-checkbox"
      />
      <span class="icon"><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="moon"
          class="svg-inline--fa fa-moon moon"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        ><path
            fill="currentColor"
            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"
          ></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="sun"
          class="svg-inline--fa fa-sun sun"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        ><path
            fill="currentColor"
            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"
          ></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
!function (theme) {
  if (theme === 'dark') {
    document.getElementById('switch-theme-checkbox').parentElement.classList.add('active')
  }
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
</script><div class="body">
<div class="nav-container" data-component="data-cassandra" data-version="4.2.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Spring Data Cassandra</span>
  <span class="version">4.2.0-SNAPSHOT</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
</div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commons/upgrade.html">Upgrading Spring Data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cassandra.html">Cassandra Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="configuration.html">Connecting to Cassandra with Spring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="schema-management.html">Schema Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cql-template.html">CQL Template API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="reactive-cassandra.html">Reactive Cassandra Support</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="template.html"><code>CassandraTemplate</code> and <code>ReactiveCassandraTemplate</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="prepared-statements.html">Prepared Statements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../object-mapping.html">Mapping</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="converters.html">Custom Conversions</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="events.html">Lifecycle Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="auditing.html">Auditing Configuration for Cassandra</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../repositories.html">Repositories</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/core-concepts.html">Core concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/definition.html">Defining Repository Interfaces</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/create-instances.html">Creating Repository Instances</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/query-methods-details.html">Defining Query Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="repositories/query-methods.html">Cassandra-specific Query Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/projections.html">Projections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/custom-implementations.html">Custom Implementations for Spring Data Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/core-domain-events.html">Publishing Events from Aggregate Roots</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/null-handling.html">Null Handling of Repository Methods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="repositories/imperative-repositories.html">Cassandra Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="repositories/reactive-repositories.html">Reactive Cassandra Repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="repositories/cdi-integration.html">CDI Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/query-keywords-reference.html">Repository query keywords</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../repositories/query-return-types-reference.html">Repository query return types</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../observability.html">Observability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlin.html">Kotlin Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/requirements.html">Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/null-safety.html">Null Safety</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/object-mapping.html">Object Mapping</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/extensions.html">Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../kotlin/coroutines.html">Coroutines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../migration-guides.html">Migration Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration-guide/migration-guide-1.5-to-2.0.html">Migration Guide from 1.x to 2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration-guide/migration-guide-2.2-to-3.0.html">Migration Guide from 2.x to 3.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../migration-guide/migration-guide-3.0-to-4.0.html">Migration Guide from 3.x to 4.x</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/spring-projects/spring-data-commons/wiki">Wiki</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="Lifecycle Events"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="file:///Users/mpaluch/git/data/spring-data-cassandra/src/main/antora/modules/ROOT/pages/cassandra/events.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
        <a href="https://github.com/spring-projects/spring-data-cassandra" title="Github">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><![CDATA[
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Github Project
        </a>
    </div>
  </div>
</aside><div class="doc">
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Spring Data Cassandra</a></li>
    <li><a href="../cassandra.html">Cassandra Support</a></li>
    <li><a href="events.html">Lifecycle Events</a></li>
  </ul>
</nav>
<article>
<h1 id="page-title" class="page">Lifecycle Events</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Cassandra mapping framework has several built-in <code>org.springframework.context.ApplicationEvent</code> events that your application can respond to by registering special beans in the <code>ApplicationContext</code>.
Being based on Spring&#8217;s application context event infrastructure lets other products, such as Spring Integration, easily receive these events as they are a well known eventing mechanism in Spring-based applications.</p>
</div>
<div class="paragraph">
<p>To intercept an object before it goes into the database, you can register a subclass of <code>org.springframework.data.cassandra.core.mapping.event.AbstractCassandraEventListener</code> that overrides the <code>onBeforeSave(…)</code> method.
When the event is dispatched, your listener is called and passed the domain object (which is a Java entity).
Entity lifecycle events can be costly and you may notice a change in the performance profile when loading large result sets.
You can disable lifecycle events on the <a href="https://docs.spring.io/spring-data/cassandra/docs/4.2.0-SNAPSHOT/api/org/springframework/data/cassandra/core/CassandraTemplate.html#setEntityLifecycleEventsEnabled(boolean)">Template API</a>.
The following example uses the <code>onBeforeSave</code> method:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class BeforeSaveListener extends AbstractCassandraEventListener&lt;Person&gt; {
	@Override
	public void onBeforeSave(BeforeSaveEvent&lt;Person&gt; event) {
		// … change values, delete them, whatever …
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Declaring these beans in your Spring <code>ApplicationContext</code> will cause them to be invoked whenever the event is dispatched.</p>
</div>
<div class="paragraph">
<p>The <code>AbstractCassandraEventListener</code> has the following callback methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onBeforeSave</code>: Called in <code>CassandraTemplate.insert(…)</code> and <code>.update(…)</code> operations before inserting or updating a row in the database.</p>
</li>
<li>
<p><code>onAfterSave</code>: Called in <code>CassandraTemplate…insert(…)</code> and <code>.update(…)</code> operations after inserting or updating a row in the database.</p>
</li>
<li>
<p><code>onBeforeDelete</code>: Called in <code>CassandraTemplate.delete(…)</code> operations before deleting row from the database.</p>
</li>
<li>
<p><code>onAfterDelete</code>: Called in <code>CassandraTemplate.delete(…)</code> operations after deleting row from the database.</p>
</li>
<li>
<p><code>onAfterLoad</code>: Called in the <code>CassandraTemplate.select(…)</code>, <code>.slice(…)</code>, and <code>.stream(…)</code> methods after each row is retrieved from the database.</p>
</li>
<li>
<p><code>onAfterConvert</code>: Called in the <code>CassandraTemplate.select(…)</code>, <code>.slice(…)</code>, and <code>.stream(…)</code> methods after converting a row retrieved from the database to a POJO.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Lifecycle events are emitted only for root-level types.
Complex types used as properties within an aggregate root are not subject to event publication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entity-callbacks"><a class="anchor" href="#entity-callbacks"></a>Entity Callbacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring Data infrastructure provides hooks for modifying an entity before and after certain methods are invoked.
Those so called <code>EntityCallback</code> instances provide a convenient way to check and potentially modify an entity in a callback fashioned style.<br>
An <code>EntityCallback</code> looks pretty much like a specialized <code>ApplicationListener</code>.
Some Spring Data modules publish store specific events (such as <code>BeforeSaveEvent</code>) that allow modifying the given entity. In some cases, such as when working with immutable types, these events can cause trouble.
Also, event publishing relies on <code>ApplicationEventMulticaster</code>. If configuring that with an asynchronous <code>TaskExecutor</code> it can lead to unpredictable outcomes, as event processing can be forked onto a Thread.</p>
</div>
<div class="paragraph">
<p>Entity callbacks provide integration points with both synchronous and reactive APIs to guarantee in-order execution at well-defined checkpoints within the processing chain, returning a potentially modified entity or an reactive wrapper type.</p>
</div>
<div class="paragraph">
<p>Entity callbacks are typically separated by API type. This separation means that a synchronous API considers only synchronous entity callbacks and a reactive implementation considers only reactive entity callbacks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Entity Callback API has been introduced with Spring Data Commons 2.2. It is the recommended way of applying entity modifications.
Existing store specific <code>ApplicationEvents</code> are still published <strong>before</strong> the invoking potentially registered <code>EntityCallback</code> instances.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="entity-callbacks.implement"><a class="anchor" href="#entity-callbacks.implement"></a>Implementing Entity Callbacks</h3>
<div class="paragraph">
<p>An <code>EntityCallback</code> is directly associated with its domain type through its generic type argument.
Each Spring Data module typically ships with a set of predefined <code>EntityCallback</code> interfaces covering the entity lifecycle.</p>
</div>
<div class="listingblock">
<div class="title">Anatomy of an <code>EntityCallback</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FunctionalInterface
public interface BeforeSaveCallback&lt;T&gt; extends EntityCallback&lt;T&gt; {

	/**
	 * Entity callback method invoked before a domain object is saved.
	 * Can return either the same or a modified instance.
	 *
	 * @return the domain object to be persisted.
	 */
	<i class="conum" data-value="1"></i><b>(1)</b>
	T onBeforeSave(T entity, <i class="conum" data-value="2"></i><b>(2)</b>
		String collection); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> specific method to be called before an entity is saved. Returns a potentially modifed instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity right before persisting.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A number of store specific arguments like the <em>collection</em> the entity is persisted to.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Anatomy of a reactive <code>EntityCallback</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@FunctionalInterface
public interface ReactiveBeforeSaveCallback&lt;T&gt; extends EntityCallback&lt;T&gt; {

	/**
	 * Entity callback method invoked on subscription, before a domain object is saved.
	 * The returned Publisher can emit either the same or a modified instance.
	 *
	 * @return Publisher emitting the domain object to be persisted.
	 */
	<i class="conum" data-value="1"></i><b>(1)</b>
	Publisher&lt;T&gt; onBeforeSave(T entity, <i class="conum" data-value="2"></i><b>(2)</b>
		String collection); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> specific method to be called on subscription, before an entity is saved. Emits a potentially modifed instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The entity right before persisting.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A number of store specific arguments like the <em>collection</em> the entity is persisted to.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Optional entity callback parameters are defined by the implementing Spring Data module and inferred from call site of <code>EntityCallback.callback()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Implement the interface suiting your application needs like shown in the example below:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>BeforeSaveCallback</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class DefaultingEntityCallback implements BeforeSaveCallback&lt;Person&gt;, Ordered {      <i class="conum" data-value="2"></i><b>(2)</b>

	@Override
	public Object onBeforeSave(Person entity, String collection) {                   <i class="conum" data-value="1"></i><b>(1)</b>

		if(collection == "user") {
		    return // ...
		}

		return // ...
	}

	@Override
	public int getOrder() {
		return 100;                                                                  <i class="conum" data-value="2"></i><b>(2)</b>
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Callback implementation according to your requirements.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Potentially order the entity callback if multiple ones for the same domain type exist. Ordering follows lowest precedence.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="entity-callbacks.register"><a class="anchor" href="#entity-callbacks.register"></a>Registering Entity Callbacks</h3>
<div class="paragraph">
<p><code>EntityCallback</code> beans are picked up by the store specific implementations in case they are registered in the <code>ApplicationContext</code>.
Most template APIs already implement <code>ApplicationContextAware</code> and therefore have access to the <code>ApplicationContext</code></p>
</div>
<div class="paragraph">
<p>The following example explains a collection of valid entity callback registrations:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>EntityCallback</code> Bean registration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Order(1)                                                           <i class="conum" data-value="1"></i><b>(1)</b>
@Component
class First implements BeforeSaveCallback&lt;Person&gt; {

	@Override
	public Person onBeforeSave(Person person) {
		return // ...
	}
}

@Component
class DefaultingEntityCallback implements BeforeSaveCallback&lt;Person&gt;,
                                                           Ordered { <i class="conum" data-value="2"></i><b>(2)</b>

	@Override
	public Object onBeforeSave(Person entity, String collection) {
		// ...
	}

	@Override
	public int getOrder() {
		return 100;                                                  <i class="conum" data-value="2"></i><b>(2)</b>
	}
}

@Configuration
public class EntityCallbackConfiguration {

    @Bean
    BeforeSaveCallback&lt;Person&gt; unorderedLambdaReceiverCallback() {   <i class="conum" data-value="3"></i><b>(3)</b>
        return (BeforeSaveCallback&lt;Person&gt;) it -&gt; // ...
    }
}

@Component
class UserCallbacks implements BeforeConvertCallback&lt;User&gt;,
                                        BeforeSaveCallback&lt;User&gt; {   <i class="conum" data-value="4"></i><b>(4)</b>

	@Override
	public Person onBeforeConvert(User user) {
		return // ...
	}

	@Override
	public Person onBeforeSave(User user) {
		return // ...
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>BeforeSaveCallback</code> receiving its order from the <code>@Order</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>BeforeSaveCallback</code> receiving its order via the <code>Ordered</code> interface implementation.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>BeforeSaveCallback</code> using a lambda expression. Unordered by default and invoked last. Note that callbacks implemented by a lambda expression do not expose typing information hence invoking these with a non-assignable entity affects the callback throughput. Use a <code>class</code> or <code>enum</code> to enable type filtering for the callback bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Combine multiple entity callback interfaces in a single implementation class.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cassandra.entity-callbacks"><a class="anchor" href="#cassandra.entity-callbacks"></a>Store specific EntityCallbacks</h3>
<div class="paragraph">
<p>Spring Data for Apache Cassandra uses the <code>EntityCallback</code> API for its auditing support and reacts on the following callbacks.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported Entity Callbacks</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Callback</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Order</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReactiveBeforeConvertCallback</code>
<code>BeforeConvertCallback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onBeforeConvert(T entity, CqlIdentifier tableName)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked before a domain object is converted to <code>com.datastax.driver.core.Statement</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ordered.LOWEST_PRECEDENCE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReactiveAuditingEntityCallback</code>
<code>AuditingEntityCallback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onBeforeConvert(Object entity, CqlIdentifier tableName)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marks an auditable entity <em>created</em> or <em>modified</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReactiveBeforeSaveCallback</code>
<code>BeforeSaveCallback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onBeforeSave(T entity, CqlIdentifier tableName, Statement statement)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoked before a domain object is saved.<br>
Can modify the target, to be persisted, <code>com.datastax.driver.core.Statement</code> containing all mapped entity information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ordered.LOWEST_PRECEDENCE</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="converters.html">Custom Conversions</a></span>
  <span class="next"><a href="auditing.html">Auditing Configuration for Cassandra</a></span>
</nav>
</article>
</div>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
              <div class="colset">
                <div class="col-left">
                  <ul class="nav-versions">
                    <li class="component is-current">
                      <a class="title" href="../index.html">Spring Data Cassandra</a>
                      <ul class="versions">
                        <li class="version is-current is-latest">
                          <a href="../index.html">
                            4.2.0-SNAPSHOT<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                    <li class="component">
                      <a class="title" href="../data-commons/index.html">Spring Data Commons</a>
                      <ul class="versions">
                        <li class="version is-latest">
                          <a href="../data-commons/index.html">
                            3.2.0-SNAPSHOT<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-right">
                  <ul>
                    <li>
                      Related Spring Documentation
                      <ul>
                        <li><a href="https://docs.spring.io/spring-framework/reference/">Spring Framework</a></li>
                        <li>
                          Spring Data
                          <ul>
                            <li><a href="https://docs.spring.io/spring-data-commons/reference/">Spring Data Commons</a></li>
                            <li><a href="https://docs.spring.io/spring-data-jpa/reference/">Spring Data JPA</a></li>
                          </ul>
                        </li>
                        <li><a href="https://docs.spring.io/spring-integration/reference/">Spring Integration</a></li>
                        <li>
                          <a href="https://docs.spring.io/spring-security/reference/">Spring Security</a>
                          <ul>
                            <li><a href="https://docs.spring.io/spring-ldap/reference/">Spring LDAP</a></li>
                            <li><a href="https://docs.spring.io/spring-session/reference/">Spring Session</a></li>
                            <li><a href="https://docs.spring.io/spring-authorization-server/reference/">Spring Authorization Server</a></li>
                            <li><a href="https://docs.spring.io/spring-Vault/reference/">Spring Vault</a></li>
                            <li><a href="https://docs.spring.io/spring-security-kerberos/reference/">Spring Security Kerberos</a></li>
                          </ul>
                        </li>
                        <li><a href="https://docs.spring.io/spring-ai/reference/">Spring AI</a></li>
                        <li><a href="https://docs.spring.io/spring-cli/reference/">Spring CLI</a></li>
                        <li><a href="https://docs.spring.io/spring-graphql/reference/">Spring GraphQL</a></li>
                        <li><a href="https://docs.spring.io/spring-shell/reference/">Spring Shell</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="footer flex">
    <div id="spring-links flex">
        <img id="springlogo" src="../_/img/spring-logo.svg" alt="Spring">
        <p class="smallest antialiased">© <script>var d = new Date();
        document.write(d.getFullYear());</script> <a href="https://www.vmware.com/">VMware</a>, Inc. or its affiliates. <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> • <a href="https://www.vmware.com/help/privacy.html" rel="noopener noreferrer">Privacy</a> • <a href="https://spring.io/trademarks">Trademark Guidelines</a> <span id="thank-you-mobile">• <a href="https://spring.io/thank-you">Thank you</a></span> • <a href="https://www.vmware.com/help/privacy/california-privacy-rights.html">Your California Privacy Rights</a> • <a class="ot-sdk-show-settings">Cookie Settings</a> <span id="teconsent"></span></p>
        <p class="smallest antialiased has-gray-text">Apache®, Apache Tomcat®, Apache Kafka®, Apache Cassandra&trade;, and Apache Geode&trade; are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java&trade;, Java&trade; SE, Java&trade; EE, and OpenJDK&trade; are trademarks of Oracle and/or its affiliates. Kubernetes® is a registered trademark of the Linux Foundation in the United States and other countries. Linux® is the registered trademark of Linus Torvalds in the United States and other countries. Windows® and Microsoft® Azure are registered trademarks of Microsoft Corporation. “AWS” and “Amazon Web Services” are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.</p>
    </div>
    <div id="social-icons" class="flex jc-between">
        <a href="https://www.youtube.com/user/SpringSourceDev" title="Youtube"><svg id="youtube-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"><circle class="cls-1" cx="20" cy="20" r="20"/><path class="cls-2" d="M30.91,14.53a2.89,2.89,0,0,0-2-2C27.12,12,20,12,20,12s-7.12,0-8.9.47a2.9,2.9,0,0,0-2,2A30.56,30.56,0,0,0,8.63,20a30.44,30.44,0,0,0,.46,5.47,2.89,2.89,0,0,0,2,2C12.9,28,20,28,20,28s7.12,0,8.9-.47a2.87,2.87,0,0,0,2-2A30.56,30.56,0,0,0,31.37,20,28.88,28.88,0,0,0,30.91,14.53ZM17.73,23.41V16.59L23.65,20Z"/></svg></a>
        <a href="https://github.com/spring-projects" title="Github"><svg id="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"/></g><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"/></svg></a>
        <a href="https://twitter.com/springcentral" title="Twitter"><svg id="twitter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"/><path id="Twitter-2" data-name="Twitter" class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z"/></svg></a>
    </div>
</footer>
<script src="../_/js/vendor/import.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/asciidoctor-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
